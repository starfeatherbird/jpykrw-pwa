<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JPY ↔ KRW 계산기</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1976d2">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; }
    body { margin: 0; padding: 24px; background: #fafafa; color: #222; }
    .card { max-width: 680px; margin: 0 auto; background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    h1 { font-size: 20px; margin: 0 0 12px; }
    h2 { font-size: 18px; margin-top: 20px; }
    .tabs { display: flex; gap: 8px; margin-bottom: 12px; }
    .tab { border: 1px solid #ccc; border-radius: 8px; background: #f9f9f9; padding: 6px 14px; cursor: pointer; }
    .tab.active { background: #1976d2; color: #fff; border-color: #1976d2; }
    .row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin: 12px 0; }
    .full { grid-column: 1 / -1; }
    label { font-size: 12px; color: #555; margin-bottom: 6px; display: block; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
    input.out { background: #f5f6f8; }
    .actions { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
    button { padding: 8px 14px; border-radius: 10px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    button:hover { background: #f0f0f0; }
    .note { font-size: 12px; color: #555; line-height: 1.6; margin-top: 10px; }
    @media (max-width:480px){ .row { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="card">
    <h1>엔 ↔ 원 계산기 <span class="pill">PWA · 실시간 환율 · 패키지 가치</span></h1>

    <div class="tabs">
      <div id="tabExchange" class="tab active">환율 계산</div>
      <div id="tabPackage" class="tab">패키지 계산</div>
    </div>

    <!-- 환율 계산 -->
    <div id="exchangeSection">
      <div class="row">
        <div>
          <label>환율 (원/엔)</label>
          <input id="rate" type="number" placeholder="예: 9.50">
        </div>
        <div>
          <label>&nbsp;</label>
          <button onclick="fetchRate()">실시간 환율</button>
        </div>
      </div>

      <div class="row">
        <div>
          <label>방향</label>
          <select id="direction">
            <option>엔 → 원 (JPY → KRW)</option>
            <option>원 → 엔 (KRW → JPY)</option>
          </select>
        </div>
        <div>
          <label>반올림 자릿수</label>
          <select id="decimals">
            <option>1자리</option>
            <option>2자리</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>금액 (엔)</label>
          <input id="amount" type="number" placeholder="예: 10,000">
        </div>
        <div>
          <label>수수료(%)</label>
          <input id="fee" type="number" placeholder="예: 1.8">
        </div>
      </div>

      <div class="row full">
        <label>결과</label>
        <input id="result" class="out" readonly>
      </div>

      <div class="actions">
        <button onclick="copyResult()">결과 복사</button>
        <button onclick="swap()">방향 바꾸기</button>
        <button onclick="resetAll()">초기화</button>
      </div>

      <p class="note">
        • 실시간 환율은 exchangerate.host → open.er-api.com → allorigins.win 순으로 시도합니다.<br>
        • 오프라인 시 마지막 환율이 캐시됩니다.<br>
        • 수수료(%)는 카드/결제 스프레드를 포함한 예상 환율 조정용입니다.
      </p>
    </div>

    <!-- 패키지 계산 -->
    <div id="packageSection" style="display:none;">
      <h2>패키지 가치 계산</h2>
      <div class="row">
        <div>
          <label>패키지 가격 (¥)</label>
          <input id="pkgPrice" type="number" placeholder="예: 2400">
        </div>
        <div>
          <label>유료재화 개수 (마법석)</label>
          <input id="pkgItems" type="number" placeholder="예: 20">
        </div>
        <div>
          <label>추가 보상 추정가 (¥) — 선택</label>
          <input id="pkgBonus" type="number" placeholder="예: 0 (확정캐릭 가치)">
        </div>
      </div>

      <h3>정가 기준 입력</h3>
      <div class="row">
        <div>
          <label>최저가 재화 개수</label>
          <input id="baseItems" type="number" placeholder="예: 85" value="85">
        </div>
        <div>
          <label>최저가 금액 (¥)</label>
          <input id="basePrice" type="number" placeholder="예: 5000" value="5000">
        </div>
        <div class="full">
          <label>정가 기준 1개당 가격 (¥)</label>
          <input id="basePerItem" class="out" type="text" readonly>
        </div>
      </div>

      <div class="row full">
        <input id="pkgResult" class="out full" readonly>
      </div>

      <p class="note">
        ※ “정가 기준”은 (최저가 금액 ÷ 재화 개수)로 자동 계산됩니다.<br>
        ※ “추정 캐릭 가치”는 (패키지 가격 − (정가×유료재화 개수))로 계산됩니다.
      </p>
    </div>
  </div>

<script>
async function fetchRate(){
  const rateInput = document.getElementById('rate');
  rateInput.value = '불러오는 중...';
  try {
    let res = await fetch('https://api.exchangerate.host/latest?base=JPY&symbols=KRW');
    let data = await res.json();
    rateInput.value = data.rates.KRW.toFixed(2);
  } catch {
    rateInput.value = '오류';
  }
}

function swap(){
  const sel = document.getElementById('direction');
  sel.selectedIndex = sel.selectedIndex === 0 ? 1 : 0;
}

function resetAll(){
  ['amount','fee','result','pkgPrice','pkgItems','pkgBonus'].forEach(id=>{
    let el = document.getElementById(id); if(el) el.value='';
  });
}

function copyResult(){
  navigator.clipboard.writeText(document.getElementById('result').value);
  alert('결과가 복사되었습니다.');
}

document.getElementById('amount').addEventListener('input', calcExchange);
document.getElementById('fee').addEventListener('input', calcExchange);
document.getElementById('rate').addEventListener('input', calcExchange);

function calcExchange(){
  const rate = parseFloat(document.getElementById('rate').value)||0;
  const amt = parseFloat(document.getElementById('amount').value)||0;
  const fee = parseFloat(document.getElementById('fee').value)||0;
  const dir = document.getElementById('direction').selectedIndex;
  const dec = document.getElementById('decimals').selectedIndex===0?1:2;
  let res = dir===0 ? amt * rate : amt / rate;
  if(fee) res *= (1 - fee/100);
  document.getElementById('result').value = res.toFixed(dec);
}

/* 탭 전환 */
document.getElementById('tabExchange').onclick = ()=>{
  document.getElementById('exchangeSection').style.display='block';
  document.getElementById('packageSection').style.display='none';
  document.getElementById('tabExchange').classList.add('active');
  document.getElementById('tabPackage').classList.remove('active');
};
document.getElementById('tabPackage').onclick = ()=>{
  document.getElementById('exchangeSection').style.display='none';
  document.getElementById('packageSection').style.display='block';
  document.getElementById('tabExchange').classList.remove('active');
  document.getElementById('tabPackage').classList.add('active');
};

/* 패키지 계산 */
function updateBasePerItem(){
  const baseItems=parseFloat(baseItemsEl.value)||0;
  const basePrice=parseFloat(basePriceEl.value)||0;
  basePerItemEl.value = baseItems>0?(basePrice/baseItems).toFixed(2):0;
}

function calcPackage(){
  updateBasePerItem();
  const base=parseFloat(basePerItemEl.value)||0;
  const pkgPrice=parseFloat(pkgPriceEl.value)||0;
  const pkgItems=parseFloat(pkgItemsEl.value)||0;
  const pkgBonus=parseFloat(pkgBonusEl.value)||0;
  const effective=(pkgPrice-pkgBonus)/pkgItems;
  const charValue=pkgPrice-(base*pkgItems);
  pkgResultEl.value=`정가 1개당: ${base.toFixed(2)}¥ / 패키지 실효가: ${effective.toFixed(2)}¥ / 확정캐릭 추정: ${charValue.toFixed(0)}¥`;
}

const pkgPriceEl=document.getElementById('pkgPrice');
const pkgItemsEl=document.getElementById('pkgItems');
const pkgBonusEl=document.getElementById('pkgBonus');
const baseItemsEl=document.getElementById('baseItems');
const basePriceEl=document.getElementById('basePrice');
const basePerItemEl=document.getElementById('basePerItem');
const pkgResultEl=document.getElementById('pkgResult');

['pkgPrice','pkgItems','pkgBonus','baseItems','basePrice'].forEach(id=>{
  document.getElementById(id).addEventListener('input',calcPackage);
});
</script>
</body>
</html>
